var pullstring=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(1),i=n(2),s=n(4);e.exports={Conversation:r.Conversation,Response:i.Response,Status:i.Status,DialogOutput:i.DialogOutput,BehaviorOutput:i.BehaviorOutput,Label:i.Label,Counter:i.Counter,Flag:i.Flag,List:i.List,Phoneme:i.Phoneme,Request:s.Request}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),o=n(3),a=n(4),u=n(5),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r(this,e),this.onResponse=null;var n={baseUrl:e.ApiBaseUrl};t&&(n.xhr=t),this._client=new o.RestClient(n),this._speech=new u.Speech,this._request=null}return i(e,[{key:"start",value:function(e,t){var n={project:e,time_zone_offset:t.timeZoneOffset};this._post(n,t)}},{key:"sendText",value:function(e,t){var n={text:e};this._post(n,t)}},{key:"sendActivity",value:function(e,t){var n={activity:e};this._post(n,t)}},{key:"sendEvent",value:function(e,t,n){var r={name:e,parameters:t||{}},i={event:r};this._post(i,n)}},{key:"startAudio",value:function(e){this._ensureRequest(e)&&this._speech.start()}},{key:"addAudio",value:function(e){this._speech.add(e)}},{key:"stopAudio",value:function(){var e=this;this._speech.getBytes(function(t){e._speech.flush(),e._postAudio(t,e._request)})}},{key:"sendAudio",value:function(e,t,n){if("[object DataView]"!==Object.prototype.toString.call(e))return void this._returnError("Audio sent to sendAudio is not a DataView");if(t!==a.Request.EAudioFormat.Wav16k)return void this._returnError("Unsupported format sent to sendAudio.");var r=this._getWavData(e);return r.error?void this._returnError(r.error):void this._postAudio(r,n)}},{key:"goTo",value:function(e,t){var n={"goto":e};this._post(n,t)}},{key:"checkForTimedResponse",value:function(e){var t={};this._post(t,e)}},{key:"getEntities",value:function(e,t){if(!Array.isArray(e))return void this._returnError("entities sent to getEntities must be an array");var n={get_entities:e};this._post(n,t)}},{key:"setEntities",value:function(e,t){if(!Array.isArray(e))return void this._returnError("entities sent to setEntities must be an array");var n={};for(var r in e){var i=e[r];n[i.name]=i.value}var s={set_entities:n};this._post(s,t)}},{key:"getConversationId",value:function(){return this._request.conversationId?this._request.conversationId:null}},{key:"getParticipantId",value:function(){return this._request.participantId?this._request.participantId:null}},{key:"_ensureRequest",value:function(e){return e&&(this._request=e),!!this._request||(this._returnError("Valid request object missing"),!1)}},{key:"_post",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this._ensureRequest(t)){var s=this._endpointForRequest(this._request),o=this._headersForRequest(this._request,r),a=this._paramsForRequest(this._request);i&&(e=this._bodyForRequest(this._request,e)),this._client.post(s,a,o,e,function(e){return n._responseHandler(e)},i)}}},{key:"_postAudio",value:function(e,t){return e?void this._post(e,this._request,"audio/l16; rate=16000",!1):void this._returnError("Unable to extract audio data")}},{key:"_headersForRequest",value:function(e,t){var n={Authorization:"Bearer "+e.apiKey,Accept:"application/json"};return n["Content-Type"]=t,n}},{key:"_paramsForRequest",value:function(e){var t={asr_language:e.language,locale:e.locale};return e.acountId&&(t.account=e.accountId),t}},{key:"_bodyForRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={};if(e.buildType!==a.Request.EBuildType.Production&&(n.build_type=e.buildType),e.restartIfModified===!1&&(n.restart_if_modified=!1),e.participantId&&(n.participant=e.participantId),t)for(var r in t)n[r]=t[r];return n}},{key:"_endpointForRequest",value:function(e){var t="conversation";return e.conversationId&&(t=t+"/"+e.conversationId),t}},{key:"_responseHandler",value:function(e){var t=new s.Response(e);t.status.success&&this._request&&(this._request.conversationId=t.conversationId,this._request.participantId=t.participantId),this.onResponse&&this.onResponse(t)}},{key:"_getWavData",value:function(e){var t=this._dataViewGetString(e,0,4);if("RIFF"!==t)return{error:"Data is not a WAV file"};var n=e.getUint16(22,!0),r=e.getUint32(24,!0),i=e.getUint16(34,!0);if(1!==n||16e3!==r||16!==i)return{error:"WAV data is not mono 16-bit data at 16k sample rate"};for(var s=12,o=e.getUint32(16,!0),a=e.getUint32(4,!0);"data"!==this._dataViewGetString(e,s,4);){if(s>a)return{error:"Cannot find data segment in WAV file"};s+=o+8,o=e.getUint32(s+4,!0)}var u=s+8;return e.buffer.slice(u)}},{key:"_dataViewGetString",value:function(e,t,n){for(var r="",i=0;i<n;i++){var s=e.getUint8(i+t);r+=String.fromCharCode(s)}return r}},{key:"_returnError",value:function(e){var t=new s.Status({success:!1,message:e});this.onResponse&&this.onResponse({status:t})}}]),e}();Object.defineProperty(c,"ApiBaseUrl",{value:"https://conversation.pullstring.ai/v1/",writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(c,"AsrSampleRate",{value:16e3,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(c,"AsrChannels",{value:1,writable:!1,enumerable:!0,configurable:!1}),e.exports={Conversation:c}},function(e,t){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={DialogResponse:"dialog",BehaviorResponse:"behavior"},a={Label:"label",Counter:"counter",Flag:"flag",List:"list"},u=function b(e){i(this,b),this.name=e.name?String(e.name):null,this.secondsSinceStart=+e.seconds_since_start},c=function m(e){i(this,m),this.name=e?String(e):null},l=function(e){function t(e,r){i(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.type=a.Label,s.value=r?String(r):null,s}return r(t,e),t}(c),f=function(e){function t(e,r){i(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.type=a.Counter,s.value=+r,s}return r(t,e),t}(c),h=function(e){function t(e,r){i(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.type=a.Flag,s.value=!!r,s}return r(t,e),t}(c),p=function(e){function t(e,r){i(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.type=a.List,s.value=Array.isArray(r)?r.slice():[],s}return r(t,e),t}(c),d=function w(e){i(this,w),this.guid=String(e)},v=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.id));r.type=o.DialogResponse,r.text=e.text?String(e.text):null,r.uri=e.uri?String(e.uri):null,r.videoFile=e.video_file?String(e.video_file):null,r.duration=e.duration?+e.duration:0,r.character=e.character?String(e.character):null,r.phonemes=[];for(var s in e.phonemes){var a=e.phonemes[s],c=new u(a);r.phonemes.push(c)}return r}return r(t,e),t}(d),_=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.id));r.type=o.BehaviorResponse,r.behavior=e.behavior?String(e.behavior):null,r.parameters={};for(var s in e.parameters)r.parameters[s]=e.parameters[s];return r}return r(t,e),t}(d),y=function R(e){i(this,R),this.code=+e.code,this.message=e.message?String(e.message):null,this.success=!!e.success},g=function k(e){i(this,k),this.status=new y(e.status),this.outputs=[];for(var t in e.outputs){var n=e.outputs[t];if(n.type===o.DialogResponse){var r=new v(n);this.outputs.push(r)}else if(n.type===o.BehaviorResponse){var a=new _(n);this.outputs.push(a)}}this.entities=[];var u=e.entities;for(var c in u)if(u.hasOwnProperty(c)){var d=u[c],g="undefined"==typeof d?"undefined":s(d);if("boolean"===g){var b=new h(c,d);this.entities.push(b)}else if("number"===g){var m=new f(c,d);this.entities.push(m)}else if("string"===g){var w=new l(c,d);this.entities.push(w)}else if("object"===g&&Array.isArray(d)){var R=new p(c,d);this.entities.push(R)}}this.lastModified=e.last_modified?new Date(e.last_modified):null,this.conversationId=e.conversation?String(e.conversation):null,this.participantId=e.participant?String(e.participant):null,this.etag=e.etag?String(e.etag):null,this.timedResponseInterval=e.timed_response_interval?e.timed_response_interval:-1,this.asrHypothesis=e.asr_hypothesis?String(e.asr_hypothesis):null,e.timed_response_interrubtable?this.timedResponseInterruptible=Boolean(e.timed_response_interrubtable):this.timedResponseInterruptible=!1};g.EEntityType=a,g.EOutputType=o,e.exports={Response:g,Status:y,DialogOutput:v,BehaviorOutput:_,Label:l,Counter:f,Flag:h,List:p,Phoneme:u}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){n(this,e),this.decode=t.decode||JSON.parse,this.encode=t.encode||JSON.stringify,this.baseUrl=t.baseUrl,this.XMLHttpRequest=t.xhr||XMLHttpRequest}return r(e,[{key:"get",value:function(e,t,n,r){if(this.baseUrl){var i=this._url(e,t);this._sendRequest(i,"GET",n,r)}}},{key:"post",value:function(e,t,n,r,i){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(this.baseUrl){var o=this._url(e,t);s&&this.encode&&(r=this.encode(r)),this._sendRequest(o,"POST",n,i,r)}}},{key:"put",value:function(e,t,n,r,i){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(this.baseUrl){var o=this._url(e,t);s&&this.encode&&(r=this.encode(r)),this._sendRequest(o,"POST",n,i,r)}}},{key:"delete",value:function(e,t,n,r){if(this.baseUrl){var i=this._url(e,t);this._sendRequest(i,"DELETE",n,r)}}},{key:"_url",value:function(e,t){var n=this.baseUrl;n.endsWith("/")||(n+="/");var r=[];for(var i in t)if(t.hasOwnProperty(i)){var s=encodeURIComponent(i),o=encodeURIComponent(t[i]),a=s+"="+o;r.push(a)}return""+n+e+"?"+r.join("&")}},{key:"_sendRequest",value:function(e,t,n,r){var i=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=new this.XMLHttpRequest;o.open(t,e,!0);for(var a in n)n.hasOwnProperty(a)&&o.setRequestHeader(a,n[a]);o.onreadystatechange=function(){if(4===o.readyState){var e={},t={};t.code=o.status,t.success=o.status<400,t.success?(e=o.responseText,i.decode&&(e=i.decode(e))):t.message=o.responseText,e.status=t,r&&r(e)}},o.send(s)}}]),e}();e.exports={RestClient:i}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r={Sandbox:"sandbox",Staging:"staging",Production:"production"},i={RawPcm16k:0,Wav16k:1},s=function o(e){n(this,o),this.apiKey=e.apiKey,this.participantId=e.participant,this.buildType=e.buildType||r.Production,this.conversationId=e.conversationId,this.language=e.language||"en-US",this.locale=e.locale||"en-US",this.accountId=e.accountId,this.timeZoneOffset=e.timeZoneOffset||0,this.restartIfModified=e.restartIfModified||!0};s.EBuildType=r,s.EAudioFormat=i,e.exports={Request:s}},function(e,t,n){(function(t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),a=r(o),u=function(){function e(){i(this,e),this._callback=null,this._worker=null}return s(e,[{key:"start",value:function(){var e=this;this._worker=new Worker(this._getSpeechWorkerUrl()),this._worker.onmessage=function(t){e._callback&&e._callback(t)}}},{key:"add",value:function(e){var t={command:"listen",buffer:e};this._worker.postMessage(t,[t.buffer.buffer])}},{key:"flush",value:function(){this._worker.postMessage({command:"flush"})}},{key:"getBytes",value:function(e){if(!e)throw new Error("Callback must be provide to process audio");this._callback=function(t){e&&e(t.data)},this._worker.postMessage({command:"getMono"})}},{key:"_getSpeechWorkerUrl",value:function(){var e=window.URL&&URL.createObjectURL.bind(URL)||window.webkitURL&&window.webkitURL.createObjectURL.bind(window.webkitURL)||window.createObjectURL;e||(e=t.createObjectURL);var n=a["default"].toString(),r=n.indexOf("{"),i=n.lastIndexOf("}");if(r>0&&i>r){var s=n.substring(r+1,i);return e(new Blob([s]),{type:"text/javascript"})}return null}}]),e}();e.exports={Speech:u}}).call(t,function(){return this}())},function(e,t){"use strict";function n(){function e(e){s.push(e.buffer),i+=e.buffer.length}function t(e){i=0,s=[]}function n(e,t){for(var n=new Float32Array(t),r=0,i=0;i<e.length;i++)n.set(e[i],r),r+=e[i].length;return n}function r(e){for(var t=n(s,i),r=2*t.length,o=new ArrayBuffer(r),u=new DataView(o),c=0,l=0;l<t.length;l++){var f=t[l],h=Math.max(-1,Math.min(1,f)),p=h<0?32768*h:32767*h;u.setUint16(c,p,!0),c+=2}a.postMessage(u)}var i=0,s=[],o={},a=this;this.onmessage=function(e){var t=e.data.command;o[t]&&o[t](e.data)},o={listen:e,flush:t,getMono:r}}e.exports=n}]);
//# sourceMappingURL=pullstring.min.js.map